@model ShadowWizardMath.Models.Level

<!DOCTYPE html>
<html>
<head>
    <title>Level View</title>
    <link rel="stylesheet" href="/css/site.css" />

    @*import JQuery*@
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        #frame-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 1152px; 
            height: 400px; 
            overflow: hidden;
            z-index: 10;
        }
        #game-container {
            width: 1152px;
            height: 500px;
            margin: 0 auto;
            background-color: black;
            position: relative;
            overflow: hidden;
        }

        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 1152px;
            height: 400px; 
            background-size: 100% auto;
            background-repeat: no-repeat;
            animation: scrollBackground 10s linear infinite;
        }




        #character-image {
            position: absolute;
            top: 0;
            left: 0; 
            z-index: 9999; 
            transform: translateY(130px) translateX(130px) scale(2);     
        }

        #first-enemy {
            position: absolute;
            top: 0; 
            left: 0; 
            z-index: 9999;
            transform: translateY(210px) translateX(1070px) scale(2);
        }
        .player-info {
            position: absolute;
            top: 370px;
            left: 100px; 
            font-size: 20px;
            color: white;
            display: flex; 
            align-items: center; 
            transform: scale(2);
        }

        .player-details {
            margin-left: 10px;
        }

        #nextStageButton {
            position: absolute;
            top: 15px; 
            right: 10px;
            z-index: 11;
            font-size: 16px;
            padding: 10px 20px;
            background-color: #258cfb;
            color: white;
            border: none;
            cursor: pointer;
        }

        .prompt{
            position: absolute;
            top:30px;
            left:500px;
            z-index:14;
            text-align: center;

        }

        .prompt-text {
            transform: translateY(-150%); 
            font-size: 32px;
        }

        .answerbox1 {
            position: absolute;
            top: 300px;
            left: 310px;
            z-index: 114;
            text-align: center;
        }
        .answerbox1-text{
            transform: translateY(-147%);
            font-size:24px;
            top: 0px;
            left: 310px;
            color: white;
            z-index: 206;
            text-align: center;
            pointer-events: none;
        }
        .answerbox2 {
            position: absolute;
            top: 434px;
            left: 660px;
            z-index: 114;
        }

        .answerbox2-text {
            transform: translateY(-147%);
            font-size: 24px;
            top: 0px;
            left: 310px;
            color: white;
            z-index: 206;
            text-align: center;
            pointer-events: none;
        }
        .answerbox3 {
            position: absolute;
            top: 490px;
            left: 660px;
            z-index: 114;
            text-align: center;

        }

        .answerbox3-text {
            transform: translateY(-147%);
            font-size: 24px;
            top: 0px;
            left: 310px;
            color: white;
            z-index: 206;
            text-align: center;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Game container -->
    <div id="game-container">
        <!-- Frame container -->
        <div id="frame-container">
            <div class="background-layer" style="background-image: url('/art/Backgrounds/Regular%20Background/MainBackgroundFrame.png')"></div>
            <div id="main-frame"></div>
        </div>
        <!-- This pulls the level from the controller 'level.Stage = 1;' -->
        <h1>Level @Model.Stage</h1>

        <!-- This declares the file name of the background image which is set by the stage. -->
        @if (Model.Stage == 1)
        {
            <div class="background-layer" style="background-image: url('/art/Backgrounds/Regular%20Background/Backgroundrunner.png')"></div>
        }
        <!-- Displaying player information -->
        <h2>Player:</h2>
        <img id="character-image" src="~/art/Shadow%20Wizard%20Player/Shadow-wizard-armed-idle.gif" alt="Character">
        <div class="player-info">
            <div class="player-details">
                <p>@Model.Player.PlayerName</p>
                <p>Coins: <span id="playerCoins">0</span></p>
            </div>
        </div>
        @{
            var mathProblems = new MathProblems();
            mathProblems.GenerateMathProblem(out int operand1, out int operand2, out string operatorString, out int correctAnswer);

            // Generate two incorrect answers
            int incorrectAnswer1 = correctAnswer + 1;
            int incorrectAnswer2 = correctAnswer - 1;
        }

        <h2>Prompt</h2>
        <div class="prompt">
            <img id="prompt-image" src="~/art/Backgrounds/Regular%20Background/Enemyaskquestion.png" alt="prompt" />
            <div class="prompt-text">
            <p>@operand1 @operatorString @operand2 = ?</p>
            </div>
        </div>
        @{
            var answerOptions = new List<int> { correctAnswer, incorrectAnswer1, incorrectAnswer2 };
            var shuffledOptions = Shuffle(answerOptions);

            // C# method for shuffling the answer options
            List<int> Shuffle(List<int> list)
            {
                var random = new Random();
                int n = list.Count;
                while (n > 1)
                {
                    n--;
                    int k = random.Next(n + 1);
                    int value = list[k];
                    list[k] = list[n];
                    list[n] = value;
                }
                return list;
            }
        }
        <!-- Answer boxes -->
    <div class="answerbox1">
        <img id="prompt-image" src="~/art/Backgrounds/Regular%20Background/Question-Answer-Box.png" alt="answerbox1" />
         <p class="answerbox1-text">@shuffledOptions[0]</p>
    </div>
    </div>
    <div class="answerbox2">
        <img id="prompt-image" src="~/art/Backgrounds/Regular%20Background/Question-Answer-Box.png" alt="answerbox2" />
        <p class="answerbox2-text">@shuffledOptions[1]</p>
    </div>
    <div class="answerbox3">
        <img id="prompt-image" src="~/art/Backgrounds/Regular%20Background/Question-Answer-Box.png" alt="answerbox3" />
        <p class="answerbox3-text">@shuffledOptions[2]</p>
    </div>


        <!-- Displaying enemies information -->
        <h2>Enemies:</h2>
        <!-- Displaying the sprite for the first enemy on top of other elements -->
        @if (ViewBag.levelEnemies.Count > 0)
        {
            var firstEnemy = ViewBag.levelEnemies[0];
            <img id="first-enemy" src="@firstEnemy.sprite" alt="Enemy">
        }


        <!-- Next Stage button -->
        <button id="nextStageButton">Next Stage</button>


    <script>
        var enemyData = @Html.Raw(Json.Serialize(ViewBag.levelEnemies));
    </script>
    <script>
        var coins = 0;
        var currentEnemyIndex = 0;

        $(document).ready(function () {
            // Function to check the selected answer
            function checkAnswer(selectedAnswer) {
                // Compare the selected answer with the correct answer
                if (selectedAnswer === @correctAnswer) {
                    alert("Correct!");
                    coins += 10;
                } else {
                    alert("Incorrect!");
                    coins -= 5;
                }
                $("#playerCoins").text(coins);
            }


            // Click event handler for the answer boxes
            $(".answerbox1 img, .answerbox2 img, .answerbox3 img").click(function () {
                var selectedAnswer = $(this).siblings("p").text(); // Get the answer text from the sibling paragraph
                checkAnswer(parseInt(selectedAnswer));
            });


        });


            // JavaScript/jQuery code for cycling through different backgrounds on button click
            $(document).ready(function () {
                var backgrounds = [
                    "/art/Backgrounds/Regular%20Background/Backgroundrunner.png",
                    "/art/Backgrounds/Black%20Background/Black-Backgroundrunner.png",
                    "/art/Backgrounds/Blue%20Background/Blue-Backgroundrunner.png",
                    "/art/Backgrounds/Green%20Background/Green-Backgroundrunner.png",
                    "/art/Backgrounds/Purple%20Background/Purple-Backgroundrunner.png",
                    "/art/Backgrounds/Red%20Background/Red-Backgroundrunner.png",
                ];

                var currentIndex = 0;

                $("#nextStageButton").click(function () {
                    currentIndex++;
                    if (currentIndex >= backgrounds.length) {
                        currentIndex = 0;
                    }

                    $(".background-layer").css("background-image", "url(" + backgrounds[currentIndex] + ")");
                });
            });
        </script>
</body>
</html>